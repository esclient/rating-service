# rating-service


# –î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è Rating Service

## üéØ –ß—Ç–æ –î–µ–ª–∞–µ—Ç –≠—Ç–æ—Ç –°–µ—Ä–≤–∏—Å

**Rating Service** ‚Äî —ç—Ç–æ –º–∏–∫—Ä–æ—Å–µ—Ä–≤–∏—Å, –∫–æ—Ç–æ—Ä—ã–π –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç —Ä–µ–π—Ç–∏–Ω–≥–∏ –º–æ–¥–æ–≤ (–º–æ–¥–∏—Ñ–∏–∫–∞—Ü–∏–π/–ø–ª–∞–≥–∏–Ω–æ–≤). –ü—Ä–µ–¥—Å—Ç–∞–≤—å—Ç–µ —ç—Ç–æ –∫–∞–∫ —Å–∏—Å—Ç–µ–º—É "–ª–∞–π–∫/–¥–∏–∑–ª–∞–π–∫", –≥–¥–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏ –º–æ–≥—É—Ç –æ—Ü–µ–Ω–∏–≤–∞—Ç—å —Ä–∞–∑–ª–∏—á–Ω—ã–µ –º–æ–¥—ã, –∞ –≤—ã –º–æ–∂–µ—Ç–µ –ø–æ–ª—É—á–∞—Ç—å —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫—É –æ —Ç–æ–º, —Å–∫–æ–ª—å–∫–æ –ª—é–¥–µ–π –ª–∞–π–∫–Ω—É–ª–∏ –∏–ª–∏ –¥–∏–∑–ª–∞–π–∫–Ω—É–ª–∏ –∫–∞–∂–¥—ã–π –º–æ–¥.

**–û—Å–Ω–æ–≤–Ω—ã–µ –§—É–Ω–∫—Ü–∏–∏:**
- ‚úÖ –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏ –º–æ–≥—É—Ç –æ—Ü–µ–Ω–∏–≤–∞—Ç—å –º–æ–¥—ã (–ø–æ–ª–æ–∂–∏—Ç–µ–ª—å–Ω—ã–µ –∏–ª–∏ –æ—Ç—Ä–∏—Ü–∞—Ç–µ–ª—å–Ω—ã–µ –æ—Ü–µ–Ω–∫–∏)
- ‚úÖ –ü–æ–ª—É—á–µ–Ω–∏–µ —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏ —Ä–µ–π—Ç–∏–Ω–≥–æ–≤ –º–æ–¥–æ–≤ (–≤—Å–µ–≥–æ, –ª–∞–π–∫–æ–≤, –¥–∏–∑–ª–∞–π–∫–æ–≤)
- ‚úÖ –ü–æ—Å—Ç—Ä–æ–µ–Ω —Å gRPC –¥–ª—è –±—ã—Å—Ç—Ä–æ–π –∫–æ–º–º—É–Ω–∏–∫–∞—Ü–∏–∏
- ‚úÖ –ò—Å–ø–æ–ª—å–∑—É–µ—Ç PostgreSQL –±–∞–∑—É –¥–∞–Ω–Ω—ã—Ö –¥–ª—è —Ö—Ä–∞–Ω–µ–Ω–∏—è
- ‚úÖ –î–æ–∫–µ—Ä–∏–∑–æ–≤–∞–Ω –¥–ª—è –ª–µ–≥–∫–æ–≥–æ —Ä–∞–∑–≤–µ—Ä—Ç—ã–≤–∞–Ω–∏—è

---

## üèóÔ∏è –û–±–∑–æ—Ä –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä—ã

–≠—Ç–æ—Ç —Å–µ—Ä–≤–∏—Å —Å–ª–µ–¥—É–µ—Ç **3-—É—Ä–æ–≤–Ω–µ–≤–æ–π –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–µ** (–æ–±—â–∏–π –ø–∞—Ç—Ç–µ—Ä–Ω –¥–ª—è –æ—Ä–≥–∞–Ω–∏–∑–∞—Ü–∏–∏ –∫–æ–¥–∞):

```
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ   Handler       ‚îÇ  ‚Üê –ü–æ–ª—É—á–∞–µ—Ç gRPC –∑–∞–ø—Ä–æ—Å—ã –æ—Ç –∫–ª–∏–µ–Ω—Ç–æ–≤
‚îÇ   (Controller)  ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
         ‚îÇ
         ‚ñº
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ   Service       ‚îÇ  ‚Üê –°–æ–¥–µ—Ä–∂–∏—Ç –±–∏–∑–Ω–µ—Å-–ª–æ–≥–∏–∫—É –∏ –≤–∞–ª–∏–¥–∞—Ü–∏—é
‚îÇ  (Business)     ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
         ‚îÇ
         ‚ñº
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ   Repository    ‚îÇ  ‚Üê –û–±—â–∞–µ—Ç—Å—è —Å –±–∞–∑–æ–π –¥–∞–Ω–Ω—ã—Ö
‚îÇ   (Data)        ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
         ‚îÇ
         ‚ñº
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ   PostgreSQL    ‚îÇ  ‚Üê –•—Ä–∞–Ω–∏—Ç —Ñ–∞–∫—Ç–∏—á–µ—Å–∫–∏–µ –¥–∞–Ω–Ω—ã–µ
‚îÇ   Database      ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
```

**–ü–æ—á–µ–º—É —Ç–∞–∫–∞—è —Å—Ç—Ä—É–∫—Ç—É—Ä–∞?**
- **–†–∞–∑–¥–µ–ª–µ–Ω–∏–µ –æ—Ç–≤–µ—Ç—Å—Ç–≤–µ–Ω–Ω–æ—Å—Ç–∏**: –ö–∞–∂–¥—ã–π —Å–ª–æ–π –∏–º–µ–µ—Ç –æ–¥–Ω—É –∑–∞–¥–∞—á—É
- **–õ–µ–≥–∫–æ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞—Ç—å**: –ú–æ–∂–Ω–æ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞—Ç—å –∫–∞–∂–¥—ã–π —Å–ª–æ–π –Ω–µ–∑–∞–≤–∏—Å–∏–º–æ
- **–õ–µ–≥–∫–æ –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞—Ç—å**: –ò–∑–º–µ–Ω–µ–Ω–∏—è –≤ –æ–¥–Ω–æ–º —Å–ª–æ–µ –Ω–µ –ª–æ–º–∞—é—Ç –¥—Ä—É–≥–∏–µ
- **–û—Ç—Ä–∞—Å–ª–µ–≤–æ–π —Å—Ç–∞–Ω–¥–∞—Ä—Ç**: –ë–æ–ª—å—à–∏–Ω—Å—Ç–≤–æ –ø—Ä–æ—Ñ–µ—Å—Å–∏–æ–Ω–∞–ª—å–Ω—ã—Ö –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–π –∏—Å–ø–æ–ª—å–∑—É—é—Ç —ç—Ç–æ—Ç –ø–∞—Ç—Ç–µ—Ä–Ω

---

## üìÅ –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –ü—Ä–æ–µ–∫—Ç–∞

```
rating-service/
‚îú‚îÄ‚îÄ src/main/java/com/esclient/ratingservice/
‚îÇ   ‚îú‚îÄ‚îÄ RatingServiceApplication.java    # –ì–ª–∞–≤–Ω–∞—è —Ç–æ—á–∫–∞ –≤—Ö–æ–¥–∞ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è
‚îÇ   ‚îú‚îÄ‚îÄ handler/
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ Handler.java                 # gRPC –æ–±—Ä–∞–±–æ—Ç—á–∏–∫ –∑–∞–ø—Ä–æ—Å–æ–≤ (–ö–æ–Ω—Ç—Ä–æ–ª–ª–µ—Ä)
‚îÇ   ‚îú‚îÄ‚îÄ service/
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ RatingService.java          # –ë–∏–∑–Ω–µ—Å-–ª–æ–≥–∏–∫–∞
‚îÇ   ‚îú‚îÄ‚îÄ repository/
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ RatingRepository.java       # –û–ø–µ—Ä–∞—Ü–∏–∏ —Å –±–∞–∑–æ–π –¥–∞–Ω–Ω—ã—Ö
‚îÇ   ‚îî‚îÄ‚îÄ model/
‚îÇ       ‚îî‚îÄ‚îÄ RateModMessage.java         # –°—É—â–Ω–æ—Å—Ç—å –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö (–ø–æ–∫–∞ –Ω–µ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è)
‚îú‚îÄ‚îÄ RATING-SERVICE
‚îÇ   ‚îî‚îÄ‚îÄ rating.proto                    # –û–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ gRPC API
‚îú‚îÄ‚îÄ application.yaml                    # –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è Spring
‚îú‚îÄ‚îÄ pom.xml                            # –ó–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –∏ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è —Å–±–æ—Ä–∫–∏
‚îú‚îÄ‚îÄ Dockerfile                         # –ö–∞–∫ —Å–æ–±—Ä–∞—Ç—å Docker –æ–±—Ä–∞–∑
‚îî‚îÄ‚îÄ Makefile                           # –ö–æ–º–∞–Ω–¥—ã –∞–≤—Ç–æ–º–∞—Ç–∏–∑–∞—Ü–∏–∏ —Å–±–æ—Ä–∫–∏
```

---

## üîç –î–µ—Ç–∞–ª—å–Ω—ã–π –†–∞–∑–±–æ—Ä –ö–æ–¥–∞

### 1. **Handler.java** - –í—Ö–æ–¥–Ω–∞—è –î–≤–µ—Ä—å üö™

```java
@GrpcService
public class Handler extends RatingServiceGrpc.RatingServiceImplBase
```

**–ß—Ç–æ –æ–Ω –¥–µ–ª–∞–µ—Ç:**
- –≠—Ç–æ –∫–∞–∫ "—Å—Ç–æ–π–∫–∞ —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏" –≤–∞—à–µ–≥–æ —Å–µ—Ä–≤–∏—Å–∞
- –ü–æ–ª—É—á–∞–µ—Ç gRPC –∑–∞–ø—Ä–æ—Å—ã –æ—Ç –¥—Ä—É–≥–∏—Ö —Å–µ—Ä–≤–∏—Å–æ–≤ –∏–ª–∏ –∫–ª–∏–µ–Ω—Ç–æ–≤
- –ö–æ–Ω–≤–µ—Ä—Ç–∏—Ä—É–µ—Ç gRPC —Å–æ–æ–±—â–µ–Ω–∏—è –≤ Java –æ–±—ä–µ–∫—Ç—ã –∏ –Ω–∞–æ–±–æ—Ä–æ—Ç
- –í—ã–∑—ã–≤–∞–µ—Ç –±–∏–∑–Ω–µ—Å-–ª–æ–≥–∏–∫—É (—Å–ª–æ–π Service)
- –û—Ç–ø—Ä–∞–≤–ª—è–µ—Ç –æ—Ç–≤–µ—Ç—ã –æ–±—Ä–∞—Ç–Ω–æ –∫–ª–∏–µ–Ω—Ç–∞–º

**–ö–ª—é—á–µ–≤—ã–µ –ú–µ—Ç–æ–¥—ã:**

**`rateMod()` - –î–æ–±–∞–≤–∏—Ç—å –Ω–æ–≤—ã–π —Ä–µ–π—Ç–∏–Ω–≥:**
```java
public void rateMod(Rating.RateModRequest request, StreamObserver<Rating.RateModResponse> responseObserver)
```
- –ü–æ–ª—É—á–∞–µ—Ç: mod_id, author_id, rate (–ø–æ–ª–æ–∂–∏—Ç–µ–ª—å–Ω–æ–µ/–æ—Ç—Ä–∏—Ü–∞—Ç–µ–ª—å–Ω–æ–µ —á–∏—Å–ª–æ)
- –î–µ–ª–∞–µ—Ç: –í—ã–∑—ã–≤–∞–µ—Ç service –¥–ª—è —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è —Ä–µ–π—Ç–∏–Ω–≥–∞ –≤ –±–∞–∑—É –¥–∞–Ω–Ω—ã—Ö
- –í–æ–∑–≤—Ä–∞—â–∞–µ—Ç: ID —Å–æ–∑–¥–∞–Ω–Ω–æ–≥–æ —Ä–µ–π—Ç–∏–Ω–≥–∞

**`getRates()` - –ü–æ–ª—É—á–∏—Ç—å —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫—É —Ä–µ–π—Ç–∏–Ω–≥–æ–≤:**
```java  
public void getRates(Rating.GetRatesRequest request, StreamObserver<Rating.GetRatesResponse> responseObserver)
```
- –ü–æ–ª—É—á–∞–µ—Ç: mod_id
- –î–µ–ª–∞–µ—Ç: **–í –Ω–∞—Å—Ç–æ—è—â–µ–µ –≤—Ä–µ–º—è –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç –ø–æ–¥–¥–µ–ª—å–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ** (–Ω—É–∂–Ω–∞ —Ä–µ–∞–ª–∏–∑–∞—Ü–∏—è!)
- –î–æ–ª–∂–µ–Ω –≤–æ–∑–≤—Ä–∞—â–∞—Ç—å: –æ–±—â–µ–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ —Ä–µ–π—Ç–∏–Ω–≥–æ–≤, –ª–∞–π–∫–æ–≤, –¥–∏–∑–ª–∞–π–∫–æ–≤ –¥–ª—è —ç—Ç–æ–≥–æ –º–æ–¥–∞

**–í–∞–∂–Ω—ã–µ –ó–∞–º–µ—Ç–∫–∏:**
- `@GrpcService` –≥–æ–≤–æ—Ä–∏—Ç Spring, —á—Ç–æ —ç—Ç–æ –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç gRPC –∑–∞–ø—Ä–æ—Å—ã
- `StreamObserver` ‚Äî —ç—Ç–æ —Ç–æ, –∫–∞–∫ gRPC –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç –æ—Ç–≤–µ—Ç—ã –æ–±—Ä–∞—Ç–Ω–æ
- –û–±—Ä–∞–±–æ—Ç–∫–∞ –∏—Å–∫–ª—é—á–µ–Ω–∏–π: –ï—Å–ª–∏ —á—Ç–æ-—Ç–æ –∏–¥–µ—Ç –Ω–µ —Ç–∞–∫, –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç –æ—à–∏–±–∫—É –æ–±—Ä–∞—Ç–Ω–æ –∫–ª–∏–µ–Ω—Ç—É

### 2. **RatingService.java** - –ú–æ–∑–≥ üß†

```java
@Service
public final class RatingService
```

**–ß—Ç–æ –æ–Ω –¥–µ–ª–∞–µ—Ç:**
- –°–æ–¥–µ—Ä–∂–∏—Ç –±–∏–∑–Ω–µ—Å-–ª–æ–≥–∏–∫—É ("–ø—Ä–∞–≤–∏–ª–∞" –≤–∞—à–µ–≥–æ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è)
- –í–∞–ª–∏–¥–∏—Ä—É–µ—Ç –¥–∞–Ω–Ω—ã–µ –ø–µ—Ä–µ–¥ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ–º
- –ö–æ–Ω–≤–µ—Ä—Ç–∏—Ä—É–µ—Ç –∏—Å–∫–ª—é—á–µ–Ω–∏—è –≤ –ø–æ–Ω—è—Ç–Ω—ã–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—é –æ—à–∏–±–∫–∏
- –î–µ–π—Å—Ç–≤—É–µ—Ç –∫–∞–∫ –º–æ—Å—Ç –º–µ–∂–¥—É Handler –∏ Repository

**–ö–ª—é—á–µ–≤–æ–π –ú–µ—Ç–æ–¥:**

**`rateMod()` - –û–±—Ä–∞–±–æ—Ç–∞—Ç—å —Ä–µ–π—Ç–∏–Ω–≥:**
```java
public int rateMod(long mod_id, long author_id, int rate) {
    try {
        return (int) repository.addRate(mod_id, author_id, rate);
    } catch (SQLException e) {
        throw new RuntimeException("Failed to add rating", e);
    }
}
```

**–ß—Ç–æ –∑–¥–µ—Å—å –ø—Ä–æ–∏—Å—Ö–æ–¥–∏—Ç:**
1. –ü—Ä–∏–Ω–∏–º–∞–µ—Ç –¥–∞–Ω–Ω—ã–µ —Ä–µ–π—Ç–∏–Ω–≥–∞
2. –í—ã–∑—ã–≤–∞–µ—Ç repository –¥–ª—è —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è –≤ –±–∞–∑–µ –¥–∞–Ω–Ω—ã—Ö
3. –ï—Å–ª–∏ –æ–ø–µ—Ä–∞—Ü–∏—è —Å –±–∞–∑–æ–π –¥–∞–Ω–Ω—ã—Ö –Ω–µ —É–¥–∞–µ—Ç—Å—è, –∫–æ–Ω–≤–µ—Ä—Ç–∏—Ä—É–µ—Ç SQL –æ—à–∏–±–∫—É –≤ –æ–±—â—É—é runtime –æ—à–∏–±–∫—É
4. –í–æ–∑–≤—Ä–∞—â–∞–µ—Ç ID –Ω–æ–≤–æ–≥–æ —Ä–µ–π—Ç–∏–Ω–≥–∞

**–ü–æ—á–µ–º—É —ç—Ç–æ—Ç —Å–ª–æ–π —Å—É—â–µ—Å—Ç–≤—É–µ—Ç:**
- **–í–∞–ª–∏–¥–∞—Ü–∏—è**: –ú–æ–∂–µ—Ç –¥–æ–±–∞–≤–∏—Ç—å –ø—Ä–æ–≤–µ—Ä–∫–∏ —Ç–∏–ø–∞ "—Ä–µ–π—Ç–∏–Ω–≥ –¥–æ–ª–∂–µ–Ω –±—ã—Ç—å –º–µ–∂–¥—É -5 –∏ +5"
- **–ë–∏–∑–Ω–µ—Å-–ø—Ä–∞–≤–∏–ª–∞**: –ú–æ–∂–µ—Ç –¥–æ–±–∞–≤–∏—Ç—å –ª–æ–≥–∏–∫—É —Ç–∏–ø–∞ "–ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏ –Ω–µ –º–æ–≥—É—Ç –æ—Ü–µ–Ω–∏–≤–∞—Ç—å –æ–¥–∏–Ω –º–æ–¥ –¥–≤–∞–∂–¥—ã"
- **–û–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫**: –ö–æ–Ω–≤–µ—Ä—Ç–∏—Ä—É–µ—Ç —Ç–µ—Ö–Ω–∏—á–µ—Å–∫–∏–µ –æ—à–∏–±–∫–∏ –≤ –±–∏–∑–Ω–µ—Å-–æ—à–∏–±–∫–∏

### 3. **RatingRepository.java** - –ì–æ–≤–æ—Ä—è—â–∏–π —Å –ë–∞–∑–æ–π –î–∞–Ω–Ω—ã—Ö üíæ

```java
@Repository  
public class RatingRepository
```

**–ß—Ç–æ –æ–Ω –¥–µ–ª–∞–µ—Ç:**
- –ï–¥–∏–Ω—Å—Ç–≤–µ–Ω–Ω–∞—è —Ä–∞–±–æ—Ç–∞ ‚Äî –æ–±—â–∞—Ç—å—Å—è —Å –±–∞–∑–æ–π –¥–∞–Ω–Ω—ã—Ö
- –°–æ–¥–µ—Ä–∂–∏—Ç –≤—Å–µ SQL –∑–∞–ø—Ä–æ—Å—ã
- –ü—Ä–∞–≤–∏–ª—å–Ω–æ –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç —Å–æ–µ–¥–∏–Ω–µ–Ω–∏—è —Å –±–∞–∑–æ–π –¥–∞–Ω–Ω—ã—Ö
- –í–æ–∑–≤—Ä–∞—â–∞–µ—Ç —Å—ã—Ä—ã–µ –¥–∞–Ω–Ω—ã–µ (–Ω–∏–∫–∞–∫–æ–π –±–∏–∑–Ω–µ—Å-–ª–æ–≥–∏–∫–∏ –∑–¥–µ—Å—å –Ω–µ—Ç)

**–ö–ª—é—á–µ–≤—ã–µ –ú–µ—Ç–æ–¥—ã:**

**`addRate()` - –í—Å—Ç–∞–≤–∏—Ç—å –Ω–æ–≤—ã–π —Ä–µ–π—Ç–∏–Ω–≥:**
```java
public long addRate(long modId, long authorId, int rate) throws SQLException
```
**SQL:**
```sql
INSERT INTO rates (author_id, mod_id, rate) VALUES (?, ?, ?)
```
**–ß—Ç–æ –ø—Ä–æ–∏—Å—Ö–æ–¥–∏—Ç:**
1. –û—Ç–∫—Ä—ã–≤–∞–µ—Ç —Å–æ–µ–¥–∏–Ω–µ–Ω–∏–µ —Å –±–∞–∑–æ–π –¥–∞–Ω–Ω—ã—Ö –∏–∑ –ø—É–ª–∞ —Å–æ–µ–¥–∏–Ω–µ–Ω–∏–π
2. –ü–æ–¥–≥–æ—Ç–∞–≤–ª–∏–≤–∞–µ—Ç SQL statement —Å –ø–∞—Ä–∞–º–µ—Ç—Ä–∞–º–∏ (–ø—Ä–µ–¥–æ—Ç–≤—Ä–∞—â–∞–µ—Ç SQL –∏–Ω—ä–µ–∫—Ü–∏–∏!)
3. –í—ã–ø–æ–ª–Ω—è–µ—Ç –≤—Å—Ç–∞–≤–∫—É
4. –ü–æ–ª—É—á–∞–µ—Ç –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ —Å–≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞–Ω–Ω—ã–π ID –Ω–æ–≤–æ–π —Å—Ç—Ä–æ–∫–∏
5. –í–æ–∑–≤—Ä–∞—â–∞–µ—Ç —ç—Ç–æ—Ç ID
6. –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –∑–∞–∫—Ä—ã–≤–∞–µ—Ç —Å–æ–µ–¥–∏–Ω–µ–Ω–∏–µ (try-with-resources)

**`getTotalRates()` - –ü–æ–¥—Å—á–∏—Ç–∞—Ç—å —Ä–µ–π—Ç–∏–Ω–≥–∏ –¥–ª—è –º–æ–¥–∞:**
```java
public long getTotalRates(long modId) throws SQLException
```
**SQL:**
```sql
SELECT COUNT(*) FROM rates WHERE mod_id = ?
```

**–í–∞–∂–Ω—ã–µ –¢–µ—Ö–Ω–∏—á–µ—Å–∫–∏–µ –î–µ—Ç–∞–ª–∏:**
- –ò—Å–ø–æ–ª—å–∑—É–µ—Ç `DataSource` –≤–º–µ—Å—Ç–æ —Å—ã—Ä–æ–≥–æ `Connection` (–ª—É—á—à–µ –¥–ª—è –ø—É–ª–∞ —Å–æ–µ–¥–∏–Ω–µ–Ω–∏–π)
- `try-with-resources` –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –∑–∞–∫—Ä—ã–≤–∞–µ—Ç —Å–æ–µ–¥–∏–Ω–µ–Ω–∏—è —Å –±–∞–∑–æ–π –¥–∞–Ω–Ω—ã—Ö
- `PreparedStatement` –ø—Ä–µ–¥–æ—Ç–≤—Ä–∞—â–∞–µ—Ç –∞—Ç–∞–∫–∏ SQL –∏–Ω—ä–µ–∫—Ü–∏–π
- `RETURN_GENERATED_KEYS` –ø–æ–ª—É—á–∞–µ—Ç –∞–≤—Ç–æ–≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞–Ω–Ω—ã–π ID –∏–∑ –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö

### 4. **RatingServiceApplication.java** - –°—Ç–∞—Ä—Ç–µ—Ä üöÄ

```java
@SpringBootApplication
public class RatingServiceApplication {
    public static void main(String[] args) {
        SpringApplication.run(RatingServiceApplication.class, args);
    }
}
```

**–ß—Ç–æ –æ–Ω –¥–µ–ª–∞–µ—Ç:**
- –≠—Ç–æ —Ç–æ—á–∫–∞ –≤—Ö–æ–¥–∞ ‚Äî –≥–¥–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –∑–∞–ø—É—Å–∫–∞–µ—Ç—Å—è
- `@SpringBootApplication` –≥–æ–≤–æ—Ä–∏—Ç Spring:
  - –°–∫–∞–Ω–∏—Ä–æ–≤–∞—Ç—å –∫–æ–º–ø–æ–Ω–µ–Ω—Ç—ã (`@Service`, `@Repository`, `@GrpcService`)
  - –ù–∞—Å—Ç—Ä–æ–∏—Ç—å —Å–æ–µ–¥–∏–Ω–µ–Ω–∏—è —Å –±–∞–∑–æ–π –¥–∞–Ω–Ω—ã—Ö
  - –ó–∞–ø—É—Å—Ç–∏—Ç—å gRPC —Å–µ—Ä–≤–µ—Ä
  - –ù–∞—Å—Ç—Ä–æ–∏—Ç—å dependency injection

### 5. **rating.proto** - –ö–æ–Ω—Ç—Ä–∞–∫—Ç üìã

```protobuf
service RatingService {
    rpc RateMod(RateModRequest) returns (RateModResponse);
    rpc GetRates(GetRatesRequest) returns (GetRatesResponse);  
}
```

**–ß—Ç–æ —ç—Ç–æ —Ç–∞–∫–æ–µ:**
- –û–ø—Ä–µ–¥–µ–ª—è–µ—Ç –∫–æ–Ω—Ç—Ä–∞–∫—Ç API (–∫–∞–∫ –≤—ã–≥–ª—è–¥—è—Ç –∑–∞–ø—Ä–æ—Å—ã/–æ—Ç–≤–µ—Ç—ã)
- –†–∞–±–æ—Ç–∞–µ—Ç –∫–∞–∫ –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å, —Å –∫–æ—Ç–æ—Ä—ã–º —Å–æ–≥–ª–∞—à–∞—é—Ç—Å—è –∏ –∫–ª–∏–µ–Ω—Ç, –∏ —Å–µ—Ä–≤–µ—Ä
- –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –∫–æ–º–ø–∏–ª–∏—Ä—É–µ—Ç—Å—è –≤ Java –∫–ª–∞—Å—Å—ã

**–¢–∏–ø—ã –°–æ–æ–±—â–µ–Ω–∏–π:**
- `RateModRequest`: mod_id, author_id, rate
- `RateModResponse`: rate_id (ID —Å–æ–∑–¥–∞–Ω–Ω–æ–≥–æ —Ä–µ–π—Ç–∏–Ω–≥–∞)
- `GetRatesRequest`: mod_id  
- `GetRatesResponse`: rates_total, likes, dislikes

---

## ‚öôÔ∏è –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–æ–Ω–Ω—ã–µ –§–∞–π–ª—ã

### **application.yaml** - –ù–∞—Å—Ç—Ä–æ–π–∫–∏ –°–µ—Ä–≤–∏—Å–∞

```yaml
spring:
  datasource:
    url: ${DATABASE_URL}           # –ü–æ–ª—É—á–∞–µ—Ç –∏–∑ –ø–µ—Ä–µ–º–µ–Ω–Ω–æ–π –æ–∫—Ä—É–∂–µ–Ω–∏—è
    driver-class-name: org.postgresql.Driver
  jpa:
    show-sql: true                 # –õ–æ–≥–∏—Ä—É–µ—Ç –≤—Å–µ SQL –∑–∞–ø—Ä–æ—Å—ã (–ø–æ–ª–µ–∑–Ω–æ –¥–ª—è –æ—Ç–ª–∞–¥–∫–∏)
    hibernate:
      ddl-auto: none              # –ù–µ —Å–æ–∑–¥–∞–≤–∞—Ç—å —Ç–∞–±–ª–∏—Ü—ã –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏
grpc:
  server:
    port: ${PORT}                 # –ü–æ—Ä—Ç gRPC —Å–µ—Ä–≤–µ—Ä–∞ –∏–∑ –æ–∫—Ä—É–∂–µ–Ω–∏—è
```

**–ö–ª—é—á–µ–≤—ã–µ –ú–æ–º–µ–Ω—Ç—ã:**
- –ò—Å–ø–æ–ª—å–∑—É–µ—Ç –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è (`${DATABASE_URL}`, `${PORT}`) –¥–ª—è –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏
- `show-sql: true` –æ–∑–Ω–∞—á–∞–µ—Ç, —á—Ç–æ –≤—ã —É–≤–∏–¥–∏—Ç–µ –≤—Å–µ –∑–∞–ø—Ä–æ—Å—ã –∫ –±–∞–∑–µ –¥–∞–Ω–Ω—ã—Ö –≤ –ª–æ–≥–∞—Ö
- `ddl-auto: none` –æ–∑–Ω–∞—á–∞–µ—Ç, —á—Ç–æ –Ω—É–∂–Ω–æ —Å–æ–∑–¥–∞–≤–∞—Ç—å —Ç–∞–±–ª–∏—Ü—ã –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö –≤—Ä—É—á–Ω—É—é

### **pom.xml** - –ó–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –∏ –°–±–æ—Ä–∫–∞

**–û—Å–Ω–æ–≤–Ω—ã–µ –ó–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏:**
- **Spring Boot 3.2.0**: –ì–ª–∞–≤–Ω—ã–π —Ñ—Ä–µ–π–º–≤–æ—Ä–∫
- **PostgreSQL**: –î—Ä–∞–π–≤–µ—Ä –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö  
- **gRPC 1.58.0**: –î–ª—è –∫–æ–º–º—É–Ω–∏–∫–∞—Ü–∏–∏ API
- **Spring Data JPA**: –î–ª—è –æ–ø–µ—Ä–∞—Ü–∏–π —Å –±–∞–∑–æ–π –¥–∞–Ω–Ω—ã—Ö
- **net.devh grpc-server-spring-boot-starter**: –°–æ–µ–¥–∏–Ω—è–µ—Ç Spring Boot + gRPC

---

## üöÄ –ö–∞–∫ –ó–∞–ø—É—Å—Ç–∏—Ç—å –≠—Ç–æ—Ç –°–µ—Ä–≤–∏—Å

### **–ü—Ä–µ–¥–≤–∞—Ä–∏—Ç–µ–ª—å–Ω—ã–µ –¢—Ä–µ–±–æ–≤–∞–Ω–∏—è:**
1. –£—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–Ω–∞—è Java 17
2. –£—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–Ω—ã–π Docker  
3. –î–æ—Å—Ç—É–ø–Ω–∞—è –±–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö PostgreSQL

### **–ù–µ–æ–±—Ö–æ–¥–∏–º—ã–µ –ü–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –û–∫—Ä—É–∂–µ–Ω–∏—è:**
(.env)
```
DATABASE_URL=jdbc:postgresql://localhost:5432/ratings_db?user=username&password=password
PORT=7777
```

### **–í–∞—Ä–∏–∞–Ω—Ç 1: –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ Make (–†–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è)**
```bash
# –°–æ–±—Ä–∞—Ç—å –∏ –∑–∞–ø—É—Å—Ç–∏—Ç—å —Å Docker
make run
```

### **–í–∞—Ä–∏–∞–Ω—Ç 2: –í—Ä—É—á–Ω—É—é —á–µ—Ä–µ–∑ Docker**
```bash
# –°–æ–±—Ä–∞—Ç—å Docker –æ–±—Ä–∞–∑
docker build -t rating-service .

# –ó–∞–ø—É—Å—Ç–∏—Ç—å –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä
docker run --rm -it \
  -e DATABASE_URL="your_db_url" \
  -e PORT=7777 \
  -p 7777:7777 \
  rating-service
```

### **–í–∞—Ä–∏–∞–Ω—Ç 3: –ü—Ä—è–º–æ–π Java (–¥–ª—è —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∏)**
```bash
# –°–æ–±—Ä–∞—Ç—å –ø—Ä–æ–µ–∫—Ç
mvn clean package -DskipTests

# –ó–∞–ø—É—Å—Ç–∏—Ç—å JAR
java -jar target/rating-service-0.0.1-SNAPSHOT.jar
```

---

## üóÑÔ∏è –°—Ö–µ–º–∞ –ë–∞–∑—ã –î–∞–Ω–Ω—ã—Ö

**–¢–∞–±–ª–∏—Ü–∞: `rates`**
```sql
CREATE TABLE rates (
    id SERIAL PRIMARY KEY,          -- –ê–≤—Ç–æ–∏–Ω–∫—Ä–µ–º–µ–Ω—Ç–Ω—ã–π ID
    author_id BIGINT NOT NULL,      -- –ö—Ç–æ –ø–æ—Å—Ç–∞–≤–∏–ª —Ä–µ–π—Ç–∏–Ω–≥
    mod_id BIGINT NOT NULL,         -- –ö–∞–∫–æ–π –º–æ–¥ –æ—Ü–µ–Ω–∏–≤–∞–ª—Å—è  
    rate INTEGER NOT NULL,          -- –ó–Ω–∞—á–µ–Ω–∏–µ —Ä–µ–π—Ç–∏–Ω–≥–∞ (+1, -1, –∏ —Ç.–¥.)
);

-- –ò–Ω–¥–µ–∫—Å—ã –¥–ª—è –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏
CREATE INDEX idx_rates_mod_id ON rates(mod_id);
CREATE INDEX idx_rates_author_id ON rates(author_id);
```

---

## üîå –ü—Ä–∏–º–µ—Ä—ã –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è API

### **–û—Ü–µ–Ω–∏—Ç—å –ú–æ–¥ (RateMod)**

**–ó–∞–ø—Ä–æ—Å:**
```protobuf
RateModRequest {
    mod_id: 12345
    author_id: 67890  
    rate: 1           // –ü–æ–ª–æ–∂–∏—Ç–µ–ª—å–Ω—ã–π —Ä–µ–π—Ç–∏–Ω–≥ (–ª–∞–π–∫)
}
```

**–û—Ç–≤–µ—Ç:**
```protobuf
RateModResponse {
    rate_id: 98765    // ID —Å–æ–∑–¥–∞–Ω–Ω–æ–π –∑–∞–ø–∏—Å–∏ —Ä–µ–π—Ç–∏–Ω–≥–∞
}
```

### **–ü–æ–ª—É—á–∏—Ç—å –°—Ç–∞—Ç–∏—Å—Ç–∏–∫—É –ú–æ–¥–∞ (GetRates)**

**–ó–∞–ø—Ä–æ—Å:**
```protobuf
GetRatesRequest {
    mod_id: 12345
}
```

**–û—Ç–≤–µ—Ç:**
```protobuf
GetRatesResponse {
    rates_total: 150  // –û–±—â–µ–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ —Ä–µ–π—Ç–∏–Ω–≥–æ–≤
    likes: 120        // –ü–æ–ª–æ–∂–∏—Ç–µ–ª—å–Ω—ã–µ —Ä–µ–π—Ç–∏–Ω–≥–∏  
    dislikes: 30      // –û—Ç—Ä–∏—Ü–∞—Ç–µ–ª—å–Ω—ã–µ —Ä–µ–π—Ç–∏–Ω–≥–∏
}
```

---

## üõ†Ô∏è –†–∞–±–æ—á–∏–π –ü—Ä–æ—Ü–µ—Å—Å –†–∞–∑—Ä–∞–±–æ—Ç–∫–∏

### **–î–æ–±–∞–≤–ª–µ–Ω–∏–µ –ù–æ–≤–æ–π –§—É–Ω–∫—Ü–∏–∏:**

1. **–û–±–Ω–æ–≤–∏—Ç—å `rating.proto`** - –û–ø—Ä–µ–¥–µ–ª–∏—Ç—å –Ω–æ–≤—ã–π RPC –º–µ—Ç–æ–¥ –∏ —Å–æ–æ–±—â–µ–Ω–∏—è
2. **–ü–µ—Ä–µ–≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞—Ç—å Java –∫–ª–∞—Å—Å—ã** - –ó–∞–ø—É—Å—Ç–∏—Ç—å `make update` 
3. **–î–æ–±–∞–≤–∏—Ç—å –º–µ—Ç–æ–¥ Repository** - –ù–∞–ø–∏—Å–∞—Ç—å SQL –∑–∞–ø—Ä–æ—Å—ã
4. **–î–æ–±–∞–≤–∏—Ç—å –º–µ—Ç–æ–¥ Service** - –î–æ–±–∞–≤–∏—Ç—å –±–∏–∑–Ω–µ—Å-–ª–æ–≥–∏–∫—É
5. **–î–æ–±–∞–≤–∏—Ç—å –º–µ—Ç–æ–¥ Handler** - –û–±—Ä–∞–±–æ—Ç–∞—Ç—å gRPC –∑–∞–ø—Ä–æ—Å—ã
6. **–¢–µ—Å—Ç–∏—Ä–æ–≤–∞—Ç—å** - –£–±–µ–¥–∏—Ç—å—Å—è, —á—Ç–æ –≤—Å–µ —Ä–∞–±–æ—Ç–∞–µ—Ç

### **–ü—Ä–∏–º–µ—Ä: –î–æ–±–∞–≤–ª–µ–Ω–∏–µ —Ñ—É–Ω–∫—Ü–∏–∏ "–£–¥–∞–ª–∏—Ç—å –†–µ–π—Ç–∏–Ω–≥":**

1. **Proto:**
```protobuf
rpc DeleteRating(DeleteRatingRequest) returns (DeleteRatingResponse);
```

2. **Repository:**
```java
public boolean deleteRating(long rateId, long authorId) throws SQLException {
    String sql = "DELETE FROM rates WHERE id = ? AND author_id = ?";
    // –†–µ–∞–ª–∏–∑–∞—Ü–∏—è
}
```

3. **Service:**
```java
public boolean deleteRating(long rateId, long authorId) {
    // –í–∞–ª–∏–¥–∞—Ü–∏—è –∏ –æ–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫
    return repository.deleteRating(rateId, authorId);
}
```

4. **Handler:**
```java
@Override
public void deleteRating(Rating.DeleteRatingRequest request, 
                        StreamObserver<Rating.DeleteRatingResponse> responseObserver) {
    // –û–±—Ä–∞–±–æ—Ç–∫–∞ –∑–∞–ø—Ä–æ—Å–∞/–æ—Ç–≤–µ—Ç–∞
}
```

---

## üö® –¢–µ–∫—É—â–∏–µ –ü—Ä–æ–±–ª–µ–º—ã –∏ TODOs

### **–ü—Ä–æ–±–ª–µ–º—ã –¥–ª—è –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è:**

1. **`getRates()` –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç –ø–æ–¥–¥–µ–ª—å–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ**
   - –í –Ω–∞—Å—Ç–æ—è—â–µ–µ –≤—Ä–µ–º—è —Ö–∞—Ä–¥–∫–æ–¥: `totalRates = 100L; likes = 75L; dislikes = 25L`
   - **–ò—Å–ø—Ä–∞–≤–∏—Ç—å:** –†–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å —Ñ–∞–∫—Ç–∏—á–µ—Å–∫–∏–µ –∑–∞–ø—Ä–æ—Å—ã –∫ –±–∞–∑–µ –¥–∞–Ω–Ω—ã—Ö –∏—Å–ø–æ–ª—å–∑—É—è –º–µ—Ç–æ–¥ `getTotalRates()`

2. **–û—Ç—Å—É—Ç—Å—Ç–≤—É—é—Ç –∑–∞–ø—Ä–æ—Å—ã –∫ –±–∞–∑–µ –¥–∞–Ω–Ω—ã—Ö –¥–ª—è —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏**
   - –ù—É–∂–Ω—ã –º–µ—Ç–æ–¥—ã –≤ Repository: `getLikes()`, `getDislikes()`
   - –ù—É–∂–Ω–æ –≤—ã–∑—ã–≤–∞—Ç—å –∏—Ö –∏–∑ —Å–ª–æ—è Service

3. **–ù–µ—Ç –æ–±—Ä–∞–±–æ—Ç–∫–∏ –æ—à–∏–±–æ–∫ –¥–ª—è –Ω–µ–≤–∞–ª–∏–¥–Ω—ã—Ö —Ä–µ–π—Ç–∏–Ω–≥–æ–≤**
   - –î–æ–ª–∂–µ–Ω –≤–∞–ª–∏–¥–∏—Ä–æ–≤–∞—Ç—å: –∑–Ω–∞—á–µ–Ω–∏—è —Ä–µ–π—Ç–∏–Ω–≥–æ–≤, –¥—É–±–ª–∏—Ä—É—é—â–∏–µ—Å—è —Ä–µ–π—Ç–∏–Ω–≥–∏ –∏ —Ç.–¥.

4. **RateModMessage.java –Ω–µ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è**
   - –≠—Ç–∞ JPA —Å—É—â–Ω–æ—Å—Ç—å —Å—É—â–µ—Å—Ç–≤—É–µ—Ç, –Ω–æ –∫–æ–¥ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç —Å—ã—Ä–æ–π SQL –≤–º–µ—Å—Ç–æ —ç—Ç–æ–≥–æ
   - –ù—É–∂–Ω–æ —Ä–µ—à–∏—Ç—å: –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å JPA —Å—É—â–Ω–æ—Å—Ç–∏ –∏–ª–∏ —É–¥–∞–ª–∏—Ç—å —ç—Ç–æ—Ç —Ñ–∞–π–ª

### **–ü—Ä–µ–¥–ª–∞–≥–∞–µ–º—ã–µ –£–ª—É—á—à–µ–Ω–∏—è:**

1. **–î–æ–±–∞–≤–∏—Ç—å –≤–∞–ª–∏–¥–∞—Ü–∏—é –≤–≤–æ–¥–∞**
   - –í–∞–ª–∏–¥–∏—Ä–æ–≤–∞—Ç—å –¥–∏–∞–ø–∞–∑–æ–Ω—ã —Ä–µ–π—Ç–∏–Ω–≥–æ–≤ (–Ω–∞–ø—Ä–∏–º–µ—Ä, -5 –¥–æ +5)
   - –ü—Ä–µ–¥–æ—Ç–≤—Ä–∞—â–∞—Ç—å –æ—Ü–µ–Ω–∫—É –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è–º–∏ –æ–¥–Ω–æ–≥–æ –º–æ–¥–∞ –Ω–µ—Å–∫–æ–ª—å–∫–æ —Ä–∞–∑

2. **–î–æ–±–∞–≤–∏—Ç—å –ø—Ä–∞–≤–∏–ª—å–Ω–æ–µ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ**
   - –õ–æ–≥–∏—Ä–æ–≤–∞—Ç—å –≤–∞–∂–Ω—ã–µ —Å–æ–±—ã—Ç–∏—è (–Ω–æ–≤—ã–µ —Ä–µ–π—Ç–∏–Ω–≥–∏, –æ—à–∏–±–∫–∏)
   - –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å SLF4J –≤–º–µ—Å—Ç–æ System.out.println

3. **–î–æ–±–∞–≤–∏—Ç—å –ø—Ä–æ–≤–µ—Ä–∫–∏ —Ä–∞–±–æ—Ç–æ—Å–ø–æ—Å–æ–±–Ω–æ—Å—Ç–∏**
   - –î–æ–±–∞–≤–∏—Ç—å —ç–Ω–¥–ø–æ–∏–Ω—Ç –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏ —Ä–∞–±–æ—Ç—ã —Å–µ—Ä–≤–∏—Å–∞
   - –ü—Ä–æ–≤–µ—Ä—è—Ç—å –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –∫ –±–∞–∑–µ –¥–∞–Ω–Ω—ã—Ö

4. **–î–æ–±–∞–≤–∏—Ç—å –º–µ—Ç—Ä–∏–∫–∏**
   - –û—Ç—Å–ª–µ–∂–∏–≤–∞—Ç—å –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ —Ä–µ–π—Ç–∏–Ω–≥–æ–≤ –≤ –º–∏–Ω—É—Ç—É
   - –ú–æ–Ω–∏—Ç–æ—Ä–∏—Ç—å –≤—Ä–µ–º—è –æ—Ç–≤–µ—Ç–∞

---

## üß™ –°—Ç—Ä–∞—Ç–µ–≥–∏—è –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è

### **–ù–µ–æ–±—Ö–æ–¥–∏–º—ã–µ Unit –¢–µ—Å—Ç—ã:**

**–¢–µ—Å—Ç—ã Repository:**
```java
@Test
void addRate_ShouldReturnRateId() {
    // –¢–µ—Å—Ç –≤—Å—Ç–∞–≤–∫–∏ –≤ –±–∞–∑—É –¥–∞–Ω–Ω—ã—Ö
}

@Test  
void getTotalRates_ShouldReturnCorrectCount() {
    // –¢–µ—Å—Ç –ª–æ–≥–∏–∫–∏ –ø–æ–¥—Å—á–µ—Ç–∞
}
```

**–¢–µ—Å—Ç—ã Service:**
```java
@Test
void rateMod_ShouldCallRepository() {
    // –¢–µ—Å—Ç –±–∏–∑–Ω–µ—Å-–ª–æ–≥–∏–∫–∏ —Å –º–æ–∫–∏—Ä–æ–≤–∞–Ω–Ω—ã–º repository
}
```

**–¢–µ—Å—Ç—ã Handler:**
```java
@Test
void rateMod_ShouldReturnValidResponse() {
    // –¢–µ—Å—Ç –æ–±—Ä–∞–±–æ—Ç–∫–∏ gRPC –∑–∞–ø—Ä–æ—Å/–æ—Ç–≤–µ—Ç
}
```

### **–ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏–æ–Ω–Ω—ã–µ –¢–µ—Å—Ç—ã:**
- –¢–µ—Å—Ç –ø–æ–ª–Ω–æ–≥–æ –ø–æ—Ç–æ–∫–∞: Handler ‚Üí Service ‚Üí Repository ‚Üí Database
- –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å TestContainers –¥–ª—è —Ä–µ–∞–ª—å–Ω–æ–≥–æ PostgreSQL –≤ —Ç–µ—Å—Ç–∞—Ö

---

## üîê –°–æ–æ–±—Ä–∞–∂–µ–Ω–∏—è –ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏

### **–¢–µ–∫—É—â–∏–π –°—Ç–∞—Ç—É—Å –ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏:**
- ‚úÖ –ó–∞—â–∏—Ç–∞ –æ—Ç SQL –∏–Ω—ä–µ–∫—Ü–∏–π (PreparedStatements)  
- ‚ùå –ù–µ—Ç –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏–∏/–∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏
- ‚ùå –ù–µ—Ç –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—è —Å–∫–æ—Ä–æ—Å—Ç–∏
- ‚ùå –ù–µ—Ç —Å–∞–Ω–∏—Ç–∏–∑–∞—Ü–∏–∏ –≤–≤–æ–¥–∞

### **–†–µ–∫–æ–º–µ–Ω–¥—É–µ–º—ã–µ –î–æ–ø–æ–ª–Ω–µ–Ω–∏—è –ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏:**
1. **–ê—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏—è**: –ü—Ä–æ–≤–µ—Ä–∫–∞ –ª–∏—á–Ω–æ—Å—Ç–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
2. **–ê–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—è**: –ü—Ä–æ–≤–µ—Ä–∫–∞ –º–æ–∂–µ—Ç –ª–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –æ—Ü–µ–Ω–∏–≤–∞—Ç—å —ç—Ç–æ—Ç –º–æ–¥
3. **–û–≥—Ä–∞–Ω–∏—á–µ–Ω–∏–µ —Å–∫–æ—Ä–æ—Å—Ç–∏**: –ü—Ä–µ–¥–æ—Ç–≤—Ä–∞—â–µ–Ω–∏–µ —Å–ø–∞–º-—Ä–µ–π—Ç–∏–Ω–≥–æ–≤
4. **–í–∞–ª–∏–¥–∞—Ü–∏—è –≤–≤–æ–¥–∞**: –°–∞–Ω–∏—Ç–∏–∑–∞—Ü–∏—è –≤—Å–µ—Ö –≤—Ö–æ–¥–æ–≤
5. **–ê—É–¥–∏—Ç –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ**: –õ–æ–≥–∏—Ä–æ–≤–∞—Ç—å –∫—Ç–æ —á—Ç–æ –∫–æ–≥–¥–∞ –¥–µ–ª–∞–ª

---

## üìä –°–æ–æ–±—Ä–∞–∂–µ–Ω–∏—è –ü—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏

### **–¢–µ–∫—É—â–∞—è –ü—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å:**
- ‚úÖ –ü—É–ª —Å–æ–µ–¥–∏–Ω–µ–Ω–∏–π (HikariCP)
- ‚úÖ –ü–æ–¥–≥–æ—Ç–æ–≤–ª–µ–Ω–Ω—ã–µ statements (–±—ã—Å—Ç—Ä–µ–µ —á–µ–º —Å—ã—Ä–æ–π SQL)
- ‚úÖ –ü—Ä–∞–≤–∏–ª—å–Ω–∞—è –æ—á–∏—Å—Ç–∫–∞ —Ä–µ—Å—É—Ä—Å–æ–≤ (try-with-resources)

### **–ü–æ—Ç–µ–Ω—Ü–∏–∞–ª—å–Ω—ã–µ –£–∑–∫–∏–µ –ú–µ—Å—Ç–∞:**
1. **–ó–∞–ø—Ä–æ—Å—ã –∫ –±–∞–∑–µ –¥–∞–Ω–Ω—ã—Ö**: –ù–µ—Ç –∫—ç—à–∏—Ä–æ–≤–∞–Ω–∏—è –¥–ª—è –ø–æ–ø—É–ª—è—Ä–Ω—ã—Ö –º–æ–¥–æ–≤
2. **–ù–µ—Ç –ø–∞–≥–∏–Ω–∞—Ü–∏–∏**: `getRates()` –º–æ–∂–µ—Ç –≤–µ—Ä–Ω—É—Ç—å –æ–≥—Ä–æ–º–Ω—ã–µ –Ω–∞–±–æ—Ä—ã –¥–∞–Ω–Ω—ã—Ö  
3. **–ù–µ—Ç –±–∞—Ç—á–∏–Ω–≥–∞**: –ö–∞–∂–¥—ã–π —Ä–µ–π—Ç–∏–Ω–≥ ‚Äî –æ—Ç–¥–µ–ª—å–Ω—ã–π –≤—ã–∑–æ–≤ –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö

### **–£–ª—É—á—à–µ–Ω–∏—è –ü—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏:**
1. **–î–æ–±–∞–≤–∏—Ç—å –∫—ç—à–∏—Ä–æ–≤–∞–Ω–∏–µ** (Redis) –¥–ª—è —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏ –ø–æ–ø—É–ª—è—Ä–Ω—ã—Ö –º–æ–¥–æ–≤
2. **–î–æ–±–∞–≤–∏—Ç—å –∏–Ω–¥–µ–∫—Å—ã –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö** –Ω–∞ —á–∞—Å—Ç–æ –∑–∞–ø—Ä–∞—à–∏–≤–∞–µ–º—ã–µ —Å—Ç–æ–ª–±—Ü—ã
3. **–†–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å –ø–∞–≥–∏–Ω–∞—Ü–∏—é** –¥–ª—è –±–æ–ª—å—à–∏—Ö –Ω–∞–±–æ—Ä–æ–≤ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤
4. **–ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –ø—É–ª —Å–æ–µ–¥–∏–Ω–µ–Ω–∏–π** (—É–∂–µ —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω–æ)

---

## üöÄ –†—É–∫–æ–≤–æ–¥—Å—Ç–≤–æ –ø–æ –†–∞–∑–≤–µ—Ä—Ç—ã–≤–∞–Ω–∏—é

### **Docker –†–∞–∑–≤–µ—Ä—Ç—ã–≤–∞–Ω–∏–µ:**
```bash
# –°–æ–±—Ä–∞—Ç—å –æ–±—Ä–∞–∑
docker build -t rating-service:latest .

# –ó–∞–ø—É—Å—Ç–∏—Ç—å –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä
docker run -d \
  --name rating-service \
  -e DATABASE_URL="jdbc:postgresql://db:5432/ratings" \
  -e PORT=9090 \
  -p 9090:9090 \
  rating-service:latest
```

### **Kubernetes –†–∞–∑–≤–µ—Ä—Ç—ã–≤–∞–Ω–∏–µ:**
```yaml
apiVersion: apps/v1
kind: Deployment
metadata:
  name: rating-service
spec:
  replicas: 3
  selector:
    matchLabels:
      app: rating-service
  template:
    spec:
      containers:
      - name: rating-service
        image: rating-service:latest
        ports:
        - containerPort: 9090
        env:
        - name: DATABASE_URL
          valueFrom:
            secretKeyRef:
              name: db-secret
              key: url
```

---





**–°–ª–µ–¥—É—é—â–∏–µ –®–∞–≥–∏:**
1. –ò—Å–ø—Ä–∞–≤–∏—Ç—å –º–µ—Ç–æ–¥ `getRates()` –¥–ª—è –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è —Ä–µ–∞–ª—å–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö
2. –î–æ–±–∞–≤–∏—Ç—å –ø—Ä–∞–≤–∏–ª—å–Ω—É—é –≤–∞–ª–∏–¥–∞—Ü–∏—é –≤–≤–æ–¥–∞  
3. –î–æ–±–∞–≤–∏—Ç—å –∫–æ–º–ø–ª–µ–∫—Å–Ω—ã–µ —Ç–µ—Å—Ç—ã
4. –†–∞—Å—Å–º–æ—Ç—Ä–µ—Ç—å –¥–æ–±–∞–≤–ª–µ–Ω–∏–µ –∫—ç—à–∏—Ä–æ–≤–∞–Ω–∏—è –¥–ª—è –ª—É—á—à–µ–π –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏

